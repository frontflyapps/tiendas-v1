<div class="dialog-content-wrapper">

  <mat-toolbar class="mb-2" matDialogTitle color="primary" id="toolbarHeader">
    <mat-toolbar-row fxLayoutAlign="space-between center">
      <span *ngIf="!this.isEditing" class="mat-title mb-0">{{'Añadir mensajero'|translate}}</span>
      <span *ngIf="this.isEditing" class="mat-title mb-0">{{'Editar mensajero'|translate}}</span>
      <button mat-icon-button (click)="dialogRef.close()" aria-label="Close dialog">
        <mat-icon>close</mat-icon>
      </button>
    </mat-toolbar-row>
  </mat-toolbar>

  <div mat-dialog-content class="my-dialog-content">
    <form [formGroup]="form">
      <div fxLayout="column" fxLayoutAlign="start stretch" fxLayoutGap="gappx">

        <div fxLayout="row" fxLayoutAlign="center center" class="ImageLayout">
          <div fxLayout="column" fxLayoutAlign="start start" fxLayoutAlign.lt-sm="center stretch" class="mb-2">
            <div *ngIf="loadImage" class="avatar-profile" fxFlex="row" fxLayoutAlign="center center"
              style="background-size: cover; background-position : center center; flex: none;"
              [style.background-image]="this.utilsService.getSafeImage(imageAvatar)">
              <button id="photoCameraBtn" mat-icon-button (click)="openFileBrowser($event)">
                <mat-icon style="color: white;" aria-label="Example icon-button with a heart icon">
                  photo_camera
                </mat-icon>
              </button>
            </div>
            <div *ngIf="!loadImage" class="avatar-profile" fxFlex="row" fxLayoutAlign="center center">
              <mat-icon class="avatar-icon">person_outline</mat-icon>

              <button id="photoCameraBtn" style="position: absolute;" mat-icon-button (click)="openFileBrowser($event)">
                <mat-icon style="color: white;" aria-label="Example icon-button with a heart icon">
                  photo_camera
                </mat-icon>
              </button>
            </div>
            <mat-error *ngIf="showErrorImage">
              La imagen sobrepasa los <strong>500 Kb</strong>
            </mat-error>
            <input type="file" class="hide-style" id="filePicker" (change)="handleFileSelect($event)">
          </div>
        </div>

        <div *ngIf="this.isEditing" fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="gappx">
          <span class="mat-title my-2" style="font-size:24px;">
            {{this.selectedMessenger.username}}
          </span>
        </div>



        <div fxLayout="row wrap" fxLayoutAlign="space-between start" fxLayoutGap="8px">

          <mat-form-field fxFlex="49" fxFlex.lt-md="100" appearance="outline">
            <mat-label>{{'Name'|translate}}</mat-label>
            <input required type="text" [formControl]="form.controls['name']" matInput placeholder="{{'Name'|translate}}">
            <mat-icon class="greyIcon" matSuffix>person</mat-icon>
            <mat-error *ngIf="form.controls['name'].hasError('required')">
              {{'Name'|translate}} <strong>{{'is required'|translate}}</strong>
            </mat-error>
          </mat-form-field>

          <mat-form-field fxFlex="49" fxFlex.lt-md="100" appearance="outline">
            <mat-label>{{'Lastname'|translate}}</mat-label>
            <input required type="text" matInput [formControl]="form.controls['lastName']" placeholder="{{'Lastname'|translate}}">
            <mat-icon class="greyIcon" matSuffix>person</mat-icon>
            <mat-error *ngIf="form.controls['lastName'].hasError('required')">
              {{'lastName'|translate}} <strong>{{'is required'|translate}}</strong>
            </mat-error>
          </mat-form-field>
        </div>
        <!--
        <mat-form-field appearance="outline">
          <mat-label>{{'Email'|translate}}</mat-label>
          <input required type="email" matInput [formControl]="form.controls['email']" placeholder="{{'Email'|translate}}">
          <mat-icon class="greyIcon" matSuffix>mail</mat-icon>
          <mat-error *ngIf="form.controls['email'].hasError('required')">
            {{'email'|translate}} <strong>{{'is required'|translate}}</strong>
          </mat-error>
        </mat-form-field> -->


        <mat-form-field appearance="outline">
          <mat-label>{{'Identificación'|translate}}</mat-label>
          <input required type="number" matInput [formControl]="form.controls['dni']" placeholder="{{'Identificación'|translate}}">
          <mat-icon class="greyIcon" matSuffix>credit_card</mat-icon>
          <mat-error *ngIf="form.controls['dni'].hasError('required')">
            {{'Dni'|translate}} <strong>{{'is required'|translate}}</strong>
          </mat-error>
        </mat-form-field>

        <div fxLayout="row wrap" fxLayoutAlign="space-between start" fxLayoutGap="8px">
          <mat-form-field fxFlex="49" fxFlex.lt-md="100" appearance="outline">
            <mat-label>{{'País'|translate}}</mat-label>
            <input required type="text" placeholder="{{'País'|translate}}" aria-label="Assignee" matInput
              [formControl]="form.controls['CountryId']" [matAutocomplete]="autoCountry">
            <mat-autocomplete #autoCountry="matAutocomplete" [displayWith]="displayFn">
              <mat-option *ngFor="let country of allCountries" [value]="country">
                {{utilsService.parserLanguage(country.name,language)}}
              </mat-option>
            </mat-autocomplete>
            <mat-error *ngIf="form.controls['CountryId'].hasError('required')">
              {{'País'|translate}} <strong>{{'is required'|translate}}</strong>
            </mat-error>
          </mat-form-field>

          <mat-form-field fxFlex="49" fxFlex.lt-md="100" appearance="outline">
            <mat-label>{{'City'|translate}}</mat-label>
            <input required type="text" matInput [formControl]="form.controls['city']" placeholder="{{'City'|translate}}">
            <mat-icon class="greyIcon" matSuffix>my_location</mat-icon>
            <mat-error *ngIf="form.controls['city'].hasError('required')">
              {{'City'|translate}} <strong>{{'is required'|translate}}</strong>
            </mat-error>
          </mat-form-field>
        </div>


        <div fxLayout="row wrap" fxLayoutAlign="space-between center" fxLayoutGap="gappx">
          <mat-form-field fxFlex="49" fxFlex.lt-md="100" appearance="outline">
            <mat-label>{{'Dirección'|translate}}</mat-label>
            <input required type="text" matInput [formControl]="form.controls['address']" placeholder="{{'Dirección'|translate}}">
            <mat-icon class="greyIcon" matSuffix>my_location</mat-icon>
            <mat-error *ngIf="form.controls['address'].hasError('required')">
              {{'Address'|translate}} <strong>{{'is required'|translate}}</strong>
            </mat-error>
          </mat-form-field>

          <mat-form-field fxFlex="49" fxFlex.lt-md="100" appearance="outline">
            <mat-label>{{'Phone'|translate}}</mat-label>
            <input required type="text" matInput [formControl]="form.controls['phone']" placeholder="{{'Phone'|translate}}">
            <mat-icon class="greyIcon" matSuffix>my_location</mat-icon>
            <mat-error *ngIf="form.controls['phone'].hasError('required')">
              {{'Phone'|translate}} <strong>{{'is required'|translate}}</strong>
            </mat-error>
          </mat-form-field>

        </div>


        <!-- <mat-form-field appearance="outline">
          <mat-label>{{'Description'|translate}}</mat-label>
          <textarea rows="3" matInput [formControl]="form.controls['description']" placeholder="{{'Description'|translate}}"></textarea>
          <mat-icon class="greyIcon" matSuffix>edit</mat-icon>
          <mat-error *ngIf="form.controls['description'].hasError('required')">
            {{'Description'|translate}} <strong>{{'is required'|translate}}</strong>
          </mat-error>
        </mat-form-field> -->
        <!--
        <mat-form-field appearance="outline">
          <mat-label>{{'Role'|translate}}</mat-label>
          <mat-select [disabled]="true" multiple placeholder="{{'Role'|translate}}"
            [formControl]="form.controls['roles']" required>
            <mat-option *ngFor="let role of Roles" [value]="role">
              <span class="mat-body-2">
                {{role}}
              </span>
            </mat-option>
          </mat-select>
        </mat-form-field> -->

        <mat-divider></mat-divider>
        <p class="mat-body-2 uppercase my-2">
          {{'Select the countries that will be servered by this messenger'|translate}}</p>

        <mat-form-field appearance="outline">
          <mat-label>{{'Countries'|translate}}</mat-label>
          <mat-chip-list #chipList>
            <mat-chip *ngFor="let country of selectedCountries" [selectable]="selectable" [removable]="removable"
              (removed)="remove(country)">
              <span class="mat-body-2">{{this.utilsService.parserLanguage(country.name,this.language)}}</span>
              <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
            </mat-chip>
            <input placeholder="{{'Add countries...'|translate}}" #fruitInput [formControl]="countryCtrl" [matAutocomplete]="auto"
              [matChipInputFor]="chipList" [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur"
              (matChipInputTokenEnd)="add($event)">
          </mat-chip-list>
          <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selected($event)">
            <mat-option *ngFor="let country of this.allContriesAutocomplete" [value]="country">
              <span class="mat-body-2">{{this.utilsService.parserLanguage(country.name,this.language) }}</span>
            </mat-option>
          </mat-autocomplete>
          <mat-error *ngIf="form.controls['CountryIds'].invalid">
            {{'Countries'|translate}} <strong>{{'are required'|translate}}</strong>
          </mat-error>
        </mat-form-field>

        <mat-divider class="mb-2"></mat-divider>

        <p class="mat-body-2 uppercase my-2">
          {{'Users credentials'|translate}}</p>

        <mat-form-field *ngIf="localDatabaseUsers" appearance="outline">
          <mat-label>{{'Username'|translate}}</mat-label>
          <input type="text" matInput [formControl]="form.controls['username']" placeholder="{{'Username'|translate}}">
          <mat-icon class="greyIcon" matSuffix>person</mat-icon>
          <mat-error *ngIf="form.controls['username'].hasError('required')">
            {{'Username'|translate}} <strong>{{'is required'|translate}}</strong>
          </mat-error>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>{{'Email'|translate}}</mat-label>
          <input required type="email" matInput [formControl]="form.controls['email']" placeholder="{{'Email'|translate}}">
          <mat-icon class="greyIcon" matSuffix>mail</mat-icon>
          <mat-error *ngIf="form.controls['email'].hasError('required')">
            {{'email'|translate}} <strong>{{'is required'|translate}}</strong>
          </mat-error>
        </mat-form-field>

        <mat-slide-toggle *ngIf="isEditing" color="primary" (change)="onSelectSliderChange($event)" [checked]="isChangePass">
          {{'Change password'|translate}}</mat-slide-toggle>

        <div *ngIf="isChangePass" fxLayout="column" fxLayoutAlign="start stretch">
          <div fxLayout="row wrap" class="mt-2" fxLayoutAlign="space-between center">
            <mat-form-field class="example-full-width" appearance="outline" fxFlex="49" fxFlex.lt-md="100">
              <mat-label>{{'Password'|translate}}</mat-label>
              <input matInput placeholder="{{'Password'|translate}}" [type]="this.passwordType" required
                [formControl]="formPass.controls['password']">
              <mat-icon style="cursor:pointer;" *ngIf="this.passwordType == 'password'" class="greyIcon" matSuffix
                (click)="this.passwordType = 'text'">
                visibility</mat-icon>
              <mat-icon style="cursor:pointer;" *ngIf="this.passwordType == 'text'" class="greyIcon" matSuffix
                (click)="this.passwordType = 'password'">
                visibility_off</mat-icon>
              <mat-error *ngIf="formPass.controls['password'].hasError('required')">
                {{'Password'|translate}} <strong>{{'is required'|translate}}</strong>
              </mat-error>
            </mat-form-field>

            <mat-form-field class="example-full-width" appearance="outline" fxFlex="49" fxFlex.lt-md="100"
              [ngClass]="{'mat-form-field-invalid': formPass.hasError('mismatch'), 'ng-invalid': formPass.hasError('mismatch'), 'ng-valid': !formPass.hasError('mismatch')}">
              <mat-label>{{'Repeat pass'|translate}}</mat-label>
              <input matInput placeholder="{{'Repeat pass'|translate}}" required [type]="this.passwordType"
                [ngClass]="{'ng-invalid': formPass.hasError('mismatch')}" [formControl]="formPass.controls['repeat']">
              <mat-icon style="cursor:pointer;" *ngIf="this.passwordType == 'password'" class="greyIcon" matSuffix
                (click)="this.passwordType = 'text'">
                visibility</mat-icon>
              <mat-icon style="cursor:pointer;" *ngIf="this.passwordType == 'text'" class="greyIcon" matSuffix
                (click)="this.passwordType = 'password'">
                visibility_off</mat-icon>
            </mat-form-field>
          </div>
          <div fxLayout="row" fxLayoutAlign="start center" class="pb-3">
            <mat-error *ngIf="formPass.hasError('mismatch')">
              {{'Password'|translate}} <strong>{{'most be equals'|translate}}</strong>
            </mat-error>
          </div>

        </div>

      </div>

    </form>




  </div>

  <div mat-dialog-actions fxLayout="row" fxLayoutAlign="end start">
    <button mat-flat-button (click)="onUpdateProfile()" [disabled]="this.form.invalid || (isChangePass && this.formPass.invalid )"
      color="primary">{{'Save'|translate}}</button>

  </div>

</div>

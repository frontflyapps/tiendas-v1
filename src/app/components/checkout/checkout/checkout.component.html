<!-- <div *ngIf="this.loadingSearch" class="loading-shade-full">
  <mat-spinner *ngIf="this.loadingSearch" diameter="60" color="primary"></mat-spinner>
</div> -->
<div *ngIf="!loading" fxLayout='row' fxLayoutAlign='center center' style='height: 80vh'>
  <mat-spinner *ngIf="!loading" diameter="60" color="primary"></mat-spinner>
</div>
<div class="container-checkout" ngClass.lt-md="px-2" *ngIf='loading'>
  <div class="checkout sec-padding">
    <div
      *ngIf="loadingPayment"
      class="w-100 my-3"
      fxLayout="column"
      fxLayoutAlign="center center"
      fxLayoutGap="gappx"
      style="height: 400px"
    >
      <div class="loading-dots mat-title">{{ 'Procesando los datos' | translate }}</div>
      <div class="loading-dots mat-subheading-1">{{ 'Cargando pasarela de pago' | translate }}...</div>
    </div>

    <div
      *ngIf="!loadingPayment && businessConfig"
      class="billing-details"
      fxFlex="100"
      fxFlex.gt-md="50"
      fxFlex.md="50"
      ngClass.gt-sm="pr-5"
      ngClass.sm="pr-2"
      ngClass.xs="pr-0"
    >
      <mat-horizontal-stepper #stepper [linear]="'true'" labelPosition="bottom" class="billing-details">
        <mat-step *ngIf="businessConfig?.shippingType == 'normal' || businessConfig?.shippingType == 'fixed'"
                  [completed]="!noGateway && !form.get('ShippingBusinessId').invalid">
          <ng-template matStepLabel>{{ 'Datos de pago' | translate }}</ng-template>
          <p class="my-2" *ngIf="form.get('paymentType').value">
            <strong>{{ 'Seleccione una pasarela para efectuar el pago' | translate }}</strong>
          </p>

          <div class='p-2'>
            <!-- METODOS DE PAGO -->
            <div class="paymentFinal" id="payment-method">
                  <!--  fxLayout.lt-sm="column"  -->
                  <mat-radio-group
                    [formControl]="form.get('paymentType')"
                    fxLayout="row wrap"
                    fxLayoutAlign="center start"
                    fxLayoutGap="10px grid"
                    *ngIf='!onMarket'
                  >
                    <ng-container *ngFor="let pay of payments">
                      <ng-container
                        *ngIf="this.onlyCubanPeople && cart?.market === 'national' && pay?.market === 'national'"
                      >
                        <!-- fxFlex="50%" fxFlex.lt-sm="100%" -->
                        <mat-radio-button [value]="pay.id" class="radio-button-national">
                          <!-- {{this.onlyCubanPeople}} - {{cart?.market}}-->
                          <div
                            [ngClass]="{ 'payment-active': form.get('paymentType').value === pay.id }"
                            class="pay-method-container"
                            fxLayout="row"
                            fxLayoutAlign="start center"
                          >
                            <img [src]="pay.logo" class="pay-method-icon" />
                            <span class="mat-body-2 uppercase pay-method-name">
                              <!-- {{ pay.name }}-->
                            </span>
                          </div>
                        </mat-radio-button>
                      </ng-container>

                      <ng-container
                        *ngIf="
                          this.onlyCubanPeople && cart?.market === 'international' && pay?.market === 'international'
                        ">
                        <mat-radio-button
                          *ngIf="this.onlyCubanPeople && cart?.market === 'international'"
                          [value]="pay.id"
                          class="radio-button-international"
                        >
                          <div
                            [ngClass]="{ 'payment-active': form.get('paymentType').value === pay.id }"
                            class="pay-method-container"
                            fxLayoutAlign="start center"
                          >
                            <img [src]="pay.logo" class="pay-method-icon" />
                            <span class="mat-body-2 uppercase pay-method-name">
                              <!-- {{ pay.name }} -->
                            </span>
                          </div>
                        </mat-radio-button>
                      </ng-container>
                    </ng-container>
                  </mat-radio-group>
                  <mat-radio-group
                    [formControl]="form.get('paymentType')"
                    fxLayout="row wrap"
                    fxLayoutAlign="center start"
                    fxLayoutGap="10px grid"
                    *ngIf='onMarket'
                  >
                    <ng-container *ngFor="let pay of payments">
                      <ng-container>
                        <mat-radio-button
                          *ngIf='pay.market === "international"'
                          [value]="pay.id"
                          class="radio-button-international"
                        >
                          <div
                            [ngClass]="{ 'payment-active': form.get('paymentType').value === pay.id }"
                            class="pay-method-container"
                            fxLayoutAlign="start center"
                          >
                            <img [src]="pay.logo" class="pay-method-icon" />
                            <span class="mat-body-2 uppercase pay-method-name">
                              <!-- {{ pay.name }} -->
                            </span>
                          </div>
                        </mat-radio-button>
                      </ng-container>
                    </ng-container>
                  </mat-radio-group>
                </div>
          </div>
          <!-- ============================================ -->
          <!-- SELECTOR DE MONEDAS -->
          <!-- ============================================ -->
          <ng-container *ngIf="!loadingPayment
                            && (form.controls['paymentType'].value === 'visa'
                            || form.controls['paymentType'].value === 'express'
                            || form.controls['paymentType'].value === 'masterCard'
                            || form.controls['paymentType'].value === 'dinners-club-internacional'
                            || form.controls['paymentType'].value === 'jcb'
                            || form.controls['paymentType'].value === 'maestro'
                            || form.controls['paymentType'].value === 'electron'
                            || form.controls['paymentType'].value === 'tarjeta-virtual'
                            || form.controls['paymentType'].value === 'bizum'
                            || form.controls['paymentType'].value === 'iupay'
                            || form.controls['paymentType'].value === 'discover-global'
                            || multiTransfermovil)">
            <ng-container *ngIf="!loadingPayment">
              <p class="mat-body-2 my-2" style="text-transform: uppercase"
                 *ngIf="!multiTransfermovil || (multiTransfermovil && (form.get('paymentType').value === 'transfermovil'))">
                {{ 'Selecciones moneda para realizar su pago' | translate }}
              </p>
              <div fxLayout="row wrap">
                <mat-form-field fxFlex="50" fxFlex.lt-md="100" appearance="outline"
                                *ngIf='!multiTransfermovil'>
                  <mat-label>{{ 'Currency' | translate }}</mat-label>
                  <mat-select [formControl]="form.controls['currency']"
                              placeholder="{{ 'Currency' | translate }}"
                              (selectionChange)="form.controls['ShippingBusinessId'].setValue(null)">
                    <ng-container *ngFor="let currency of currencies">
                      <mat-option *ngIf="!((currency === 'EUR') && (form.get('paymentType').value === 'transfermovil'))"
                                  [value]="currency">
                                  <span class="mat-body-2">
                                    {{ currency }}
                                  </span>
                      </mat-option>
                    </ng-container>
                  </mat-select>
                </mat-form-field>
                <mat-form-field fxFlex="50" fxFlex.lt-md="100" appearance="outline"
                                *ngIf="multiTransfermovil && (form.get('paymentType').value === 'transfermovil')">
                  <mat-label>{{ 'Currency' | translate }}</mat-label>
                  <mat-select [formControl]="form.controls['currency']"
                              placeholder="{{ 'Currency' | translate }}"
                              (selectionChange)="form.controls['ShippingBusinessId'].setValue(null)">
                    <ng-container *ngFor="let currency of currenciesTuUse">
                      <mat-option *ngIf="(form.get('paymentType').value === 'transfermovil')"
                                  [value]="currency.value">
                                  <span class="mat-body-2">
                                    {{ currency.name }}
                                  </span>
                      </mat-option>
                    </ng-container>
                  </mat-select>
                </mat-form-field>
              </div>
            </ng-container>
          </ng-container>
          <!--------- SHIPPING DETAILS ----------->
          <ng-container *ngIf="form.controls['currency'].value && form.get('paymentType').value">
            <p class="my-3" *ngIf="form.get('paymentType').value?.length !== 1 && form.get('paymentType').value?.length !== 2 && form.get('paymentType').value?.length !== 3 && form.get('paymentType').value?.length !== 4">
              <strong>{{ 'Shipping Details' | translate }}</strong>
            </p>

            <div fxLayout fxLayoutAlign="start center">
              <mat-checkbox
                ngClass.xs="mb-2"
                fxFlexOrder.xs="1"
                style="margin-bottom: 12px"
                (change)="onChangeShippingRequired($event)"
                *ngIf="form.get('paymentType').value?.length !== 1 && form.get('paymentType').value?.length !== 2 && form.get('paymentType').value?.length !== 3 && form.get('paymentType').value?.length !== 4"
                [formControl]="form.get('shippingRequired')"
              >
                <span class="mat-body-2">{{ 'Solicitar envío' | translate }}</span>
              </mat-checkbox>
            </div>

            <!--SELECTORE DE PROVINCIA Y MUNICIPIOS-->
            <div fxLayout="row wrap" fxLayoutAlign="space-between center" *ngIf="showShipping && form.get('paymentType').value?.length !== 1 && form.get('paymentType').value?.length !== 2 && form.get('paymentType').value?.length !== 3 && form.get('paymentType').value?.length !== 4">
              <mat-form-field appearance="outline" fxFlex="48" fxFlex.lt-md="100">
                <mat-label>{{ 'Provincia' | translate }}</mat-label>
                <mat-select
                  (selectionChange)="onSelectProvince($event.value)"
                  [compareWith]="compareById"
                  [formControl]="form.controls['ProvinceId']"
                  placeholder="{{ 'Nombre de la provincia' | translate }}"
                  type="text">
                  <mat-option *ngFor="let province of allProvinces" [value]="province.id">
                    {{ province.name }}
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="form.controls['ProvinceId'].hasError('required')">
                  {{ 'Provincia' | translate }} <strong>{{ 'is required' | translate }}</strong>
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" fxFlex="48" fxFlex.lt-md="100">
                <mat-label>{{ 'Municipio' | translate }}</mat-label>
                <mat-select
                  (selectionChange)="form.controls['ShippingBusinessId'].setValue(null)"
                  [compareWith]="compareById"
                  [formControl]="form.controls['MunicipalityId']"
                  placeholder="{{ 'Nombre del Municipio' | translate }}"
                  type="text"
                >
                  <mat-option *ngFor="let municipio of municipalities" [value]="municipio.id">
                    {{ municipio.name }}
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="form.controls['MunicipalityId'].hasError('required')">
                  {{ 'Municipio' | translate }} <strong>{{ 'is required' | translate }}</strong>
                </mat-error>
              </mat-form-field>
            </div>

            <p class="p-3" *ngIf="shippingIsRequired">
              *{{ 'El envío es requerido para comprar en este negocio.' | translate }}
            </p>
            <div
              *ngIf="showShipping"
              class="w-100 mb-3 shippingList-box"
              fxLayout="column"
              fxLayoutAlign="start start"
              fxLayoutGap="gappx">
              <!------Load Shipping Options------>
              <div *ngIf="loadingShipping" class="loading-shade" style="height: 100%">
                <mat-spinner *ngIf="inLoading" [diameter]="40"></mat-spinner>
              </div>

              <div fxLayout="row"
                   fxLayoutAlign="space-between center"
                   *ngIf="buscoShipping && !shippingData.length">
                <mat-icon style='min-width: 60px;width: 60px;
    height: 60px;
    font-size: 47px;' color='accent'>info</mat-icon>
                <h1>
                  {{ 'Lo sentimos! No hay envíos disponibles para el municipio:' | translate }} <b>{{selectedMunicipality?.name}}</b>
                </h1>
              </div>

              <div fxLayout="row"
                   fxLayoutAlign="start center"
                   class='px-2 pt-2 w-100'
                   style='background-color: #e3e3e3; border-radius: 8px'
                   *ngIf="buscoShipping && !shippingData.length">
                <mat-icon style='min-width: 40px;width: 40px;
    height: 40px;
    font-size: 30px;' color='accent'>help</mat-icon>
                <h5>
                  {{ 'Desmarque la opción de solicitar envío para poder continuar con la compra.' | translate }}
                </h5>
              </div>

              <!--------------------------------->

              <!------Shipping List------->
              <mat-radio-group
                [formControl]="form.get('ShippingBusinessId')"
                class="w-100"
                (change)="onShippingSelected($event)"
              >
                <div *ngFor="let shipping of shippingData" fxLayout="row" fxLayoutAlign="start center" class="mb-2">
                  <mat-radio-button
                    fxFlex="100"
                    fxLayout
                    fxLayoutAlign="center center"
                    class="w-100"
                    matTooltip="{{ shipping?.Business?.name }}"
                    style="height: 50px"
                    [value]="shipping">
                    <div fxFlex="100" fxLayout="row" fxLayoutAlign="space-between center"
                         fxLayoutGap="gappx">
                      <div fxLayoutAlign="start center" fxFlex fxFlex.lt-md='70'>
                        <div fxLayout="column" fxLayoutAlign='start start'>
                          <span class="ml-2 mat-caption" style="color: black">
                            {{ shipping.shippingItems[0]?.Shipping?.Province?.name }},
                            {{ shipping.shippingItems[0]?.Shipping?.Municipality?.name }}
                          </span>
                          <div fxLayout="row" fxLayout.lt-md="column">
                          <span class="ml-2 mat-caption" style="color: black">
                            {{ 'Entrega a través de ' | translate }}
                          </span>
                            <span class="ml-2 mat-caption" style="color: black"> ({{ shipping?.Business?.name }}) </span>
                          </div>
                        </div>
                      </div>
                      <span class="taxAmount" style="font-size: 20px" fxFlex.lt-md='30'>
                      {{ shipping.totalPrice || 0 | currencyProduct: shipping.shippingItems[0]?.Shipping?.currency }}
                    </span>
                    </div>
                  </mat-radio-button>
                </div>
              </mat-radio-group>
              <!--------------------------->
            </div>
          </ng-container>
          <ng-container *ngIf='!cart?.hasShippingBusiness'>
            <p class="tex-align-center p-4">{{ 'No hay envío para estos productos' | translate}}</p>
          </ng-container>
<!--          <ng-container >-->
            <h1 *ngIf='noGateway' class="tex-align-center p-4 color-red-500">{{ 'Este negocio no tiene método de pago permitido' }}</h1>
<!--          </ng-container>-->
          <!---------------------->

          <div class="actions-buttons" fxFlex="grow" fxLayout="row" fxLayoutAlign="space-between start">
            <button [routerLink]="['/products/search']" mat-stroked-button matStepperPrevious>
              {{ 'Cancelar' | translate }}
            </button>

            <button
              id="buttonFirstStep"
              color="primary"
              mat-raised-button
              matStepperNext
              [disabled]="noGateway || form.get('ShippingBusinessId').invalid || (shippingIsRequired && !form.get('ShippingBusinessId').value) ||
                          (form.get('paymentType').value?.length == 1 || form.get('paymentType').value?.length == 2 ||
                          form.get('paymentType').value?.length == 3 || form.get('paymentType').value?.length == 4)"
            >
              {{ 'Continuar' | translate }}
            </button>
          </div>
        </mat-step>
        <mat-step [completed]="!form.invalid">
          <ng-template matStepLabel>{{ 'Destinatario' | translate }}</ng-template>

          <div *ngIf="!loadingPayment" class="header-title">
            <h3 class="grey-800" ngClass.gt-sm="h2" ngClass.xs="h4">{{ 'Billing Details' | translate }}</h3>
          </div>

          <div *ngIf="!loadingPayment" [formGroup]="form" fxLayout="row wrap" fxLayoutAlign="start start">
            <div fxFlex="100" fxLayout="column" fxLayoutAlign="start stretch" ngClass.sm="mt-2" ngClass.xs="mt-2">
              <div
                fxLayout="row"
                fxLayout.xs="column"
                fxLayoutAlign="space-between center"
                fxLayoutAlign.xs="start end"
                fxLayoutGap="0.5rem"
              >
                <p
                  class="mat-body-2 my-2"
                  style="text-transform: uppercase"
                  title="{{ 'Información del cliente que obtendrá los productos' | translate }}"
                >
                  {{ 'Datos personales del destinatario' | translate }}
                  <mat-icon
                    class="iconHelp"
                    matTooltip="{{ 'Información del cliente que obtendrá los productos' | translate }}"
                    style="cursor: pointer"
                    >help
                  </mat-icon>
                </p>

                <div fxLayout='column' fxLayout.xs='column' fxLayout.sm='column'>
                  <button
                    aria-label="Example icon-button with a menu"
                    color="primary"
                    mat-stroked-button
                    class='mb-3'
                    ngClass.xs="mb-3"
                    (click)='fillLoggedInfo()'
                  >
                    <mat-icon>book</mat-icon>
                    {{ 'Llenar con mis datos' | translate }}
                  </button>

                  <button
                    [matMenuTriggerFor]="menuContacts"
                    aria-label="Example icon-button with a menu"
                    color="primary"
                    mat-stroked-button
                    ngClass.xs="mb-3"
                  >
                    <mat-icon>book</mat-icon>
                    {{ 'Contactos guardados' | translate }}
                  </button>
                  <mat-menu #menuContacts="matMenu">
                    <ng-container *ngFor="let contact of contactsService.allContacts">
                      <button (click)="onSelectContact(contact)" mat-menu-item>
                        <mat-icon *ngIf="!contact.selected">person_outline</mat-icon>
                        <mat-icon *ngIf="contact.selected" matTooltip="{{ 'Contacto predeterminado' | translate }}"
                        >star</mat-icon
                        >
                        <span>{{ contact.name }}&nbsp;{{ contact.lastName }}</span>
                      </button>
                    </ng-container>
                    <button (click)="onAddContact()" mat-menu-item style="border-top: 4px solid #e7e4e4">
                      <mat-icon>playlist_add</mat-icon>
                      <span>{{ 'Agregar / Editar' | translate }}</span>
                    </button>
                  </mat-menu>
                </div>


              </div>

              <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                <mat-form-field appearance="outline" fxFlex="100" fxFlex.gt-md="48" fxFlex.md="48">
                  <mat-label>{{ 'Name' | translate }}</mat-label>
                  <input
                    [formControl]="this.form.controls['name']"
                    matInput
                    placeholder="{{ 'Name' | translate }}"
                    required
                    (keypress)="utilsService.keyPressAlpha($event)"
                  />
                  <mat-error *ngIf="form.controls['name'].hasError('required')">
                    {{ 'Name' | translate }} <strong>{{ 'is required' | translate }}</strong>
                  </mat-error>
                </mat-form-field>
                <mat-form-field appearance="outline" fxFlex="100" fxFlex.gt-md="48" fxFlex.md="48">
                  <mat-label>{{ 'Lastname' | translate }}</mat-label>
                  <input
                    [formControl]="this.form.controls['lastName']"
                    matInput
                    placeholder="{{ 'Lastname' | translate }}"
                    required
                    (keypress)="utilsService.keyPressAlpha($event)"
                  />
                  <mat-error *ngIf="form.controls['lastName'].hasError('required')">
                    {{ 'Lastname' | translate }} <strong>{{ 'is required' | translate }}</strong>
                  </mat-error>
                </mat-form-field>
              </div>
              <mat-form-field appearance="outline">
                <mat-label>{{ 'Email' | translate }}</mat-label>
                <input
                  [formControl]="this.form.controls['email']"
                  (keypress)="utilsService.keyLettersNumberForEmail($event)"
                  matInput
                  placeholder="{{ 'Mail for order confirmation and customer contact ' | translate }}"
                  required
                  type="email"
                />
                <mat-error *ngIf="form.controls['email'].hasError('required')">
                  {{ 'Email' | translate }} <strong>{{ 'is required' | translate }}</strong>
                </mat-error>
                <mat-error *ngIf="form.controls['email'].hasError('pattern')">
                  {{ 'Email' | translate }} <strong>{{ 'incorrect' | translate }}</strong>
                </mat-error>
              </mat-form-field>

              <p class="mat-body-2 my-2"
                style="text-transform: uppercase"
                *ngIf='canBeDelivery || showAddress'
                title="{{ 'Datos adicionales del cliente que obtendrá los productos' | translate }}">
                {{ 'Datos del destinatario' | translate }}
                <mat-icon
                  class="iconHelp"
                  *ngIf='canBeDelivery || showAddress'
                  matTooltip="{{ 'Datos adicionales del cliente que obtendrá los productos' | translate }}"
                  style="cursor: pointer"
                  >help
                </mat-icon>
              </p>

              <!-- SOLO PARA CUBANOS -->
              <ng-container *ngIf="onlyCubanPeople && (canBeDelivery || showAddress)">
                <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                  <mat-form-field appearance="outline" fxFlex="48" fxFlex.lt-md="100">
                    <mat-label>{{ 'Provincia' | translate }}</mat-label>
                    <mat-select
                      (selectionChange)="onSelectProvince($event.value)"
                      [compareWith]="compareById"
                      [formControl]="form.controls['ProvinceId']"
                      [disabled]="form.get('shippingRequired').value"
                      placeholder="{{ 'Nombre de la provincia' | translate }}"
                      type="text"
                      [required]='showAddress'
                    >
                      <mat-option *ngFor="let province of allProvinces" [value]="province.id">
                        {{ province.name }}
                      </mat-option>
                    </mat-select>
                    <mat-error *ngIf="form.controls['ProvinceId'].hasError('required')">
                      {{ 'Provincia' | translate }} <strong>{{ 'is required' | translate }}</strong>
                    </mat-error>
                  </mat-form-field>

                  <mat-form-field appearance="outline" fxFlex="48" fxFlex.lt-md="100">
                    <mat-label>{{ 'Municipio' | translate }}</mat-label>
                    <mat-select
                      (selectionChange)="form.controls['ShippingBusinessId'].setValue(null)"
                      [compareWith]="compareById"
                      [formControl]="form.controls['MunicipalityId']"
                      [disabled]="form.get('shippingRequired').value"
                      placeholder="{{ 'Nombre del Municipio' | translate }}"
                      type="text"
                      [required]='showAddress'
                    >
                      <mat-option *ngFor="let municipio of municipalities" [value]="municipio.id">
                        {{ municipio.name }}
                      </mat-option>
                    </mat-select>
                    <mat-error *ngIf="form.controls['MunicipalityId'].hasError('required')">
                      {{ 'Municipio' | translate }} <strong>{{ 'is required' | translate }}</strong>
                    </mat-error>
                  </mat-form-field>
                </div>
                <mat-error *ngIf="form.controls['ProvinceId'].hasError('forbiddenProvince')">
                  {{ '**Esta localización no coincide con la del envío seleccionado.**' | translate }}
                </mat-error>
              </ng-container>

              <!-- SOLO PARA EXTRANJEROS -->
              <ng-container *ngIf="!onlyCubanPeople && (canBeDelivery || showAddress)">
                <p class="mat-body-2 my-2" style="text-transform: uppercase">
                  {{ "Customer's location data" | translate }}
                  <mat-icon
                    class="iconHelp"
                    matTooltip="{{
                      'Country, city, region and more information about the shipping location' | translate
                    }}"
                    style="cursor: pointer"
                    >help
                  </mat-icon>
                </p>

                <mat-form-field appearance="outline">
                  <mat-label>{{ 'Country' | translate }}</mat-label>
                  <mat-select
                    [compareWith]="compareById"
                    [formControl]="form.controls['CountryId']"
                    placeholder="{{ 'Country name' | translate }}"
                    required
                    type="text"
                  >
                    <mat-option *ngFor="let country of allCountries" [value]="country.id">
                      {{ utilsService.parserLanguage(country.name, language) }}
                    </mat-option>
                  </mat-select>
                  <mat-error *ngIf="form.controls['CountryId'].hasError('required')">
                    {{ 'Country' | translate }} <strong>{{ 'is required' | translate }}</strong>
                  </mat-error>
                </mat-form-field>

                <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                  <mat-form-field appearance="outline" fxFlex="48" fxFlex.lt-md="100">
                    <mat-label>{{ 'City' | translate }}</mat-label>
                    <input
                      [formControl]="this.form.controls['city']"
                      matInput
                      placeholder="{{ 'City' | translate }}"
                      required
                      type="text"
                    />
                    <mat-error *ngIf="form.controls['city'].hasError('required')">
                      {{ 'City' | translate }} <strong>{{ 'is required' | translate }}</strong>
                    </mat-error>
                  </mat-form-field>

                  <mat-form-field appearance="outline" fxFlex="48" fxFlex.lt-md="100">
                    <mat-label>{{ 'State / Province / Region' | translate }}</mat-label>
                    <input
                      [formControl]="this.form.controls['regionProvinceState']"
                      matInput
                      placeholder="{{ 'State / Province / Region' | translate }}"
                      required
                      type="text"
                    />
                    <mat-error *ngIf="form.controls['regionProvinceState'].hasError('required')">
                      {{ 'State / Province / Region' | translate }} <strong>{{ 'is required' | translate }}</strong>
                    </mat-error>
                  </mat-form-field>
                </div>
              </ng-container>

              <div formGroupName="address" *ngIf='canBeDelivery && showAddress'>
                <div fxLayout="row" fxLayoutGap="10px">
                  <mat-form-field fxFlex="80" appearance="outline">
                    <mat-label>{{ 'Calle' | translate }}</mat-label>
                    <input
                      formControlName="street"
                      matInput
                      placeholder="{{ 'Calle' | translate }}"
                      required
                      type="text"
                    />
                    <mat-error *ngIf="this.form.controls['address']?.get('street')?.hasError('required')">
                      {{ 'Calle' | translate }} <strong>{{ 'is required' | translate }}</strong>
                    </mat-error>
                  </mat-form-field>
                  <mat-form-field fxFlex="20" appearance="outline">
                    <mat-label>{{ 'Número' | translate }}</mat-label>
                    <input
                      formControlName="number"
                      matInput
                      placeholder="{{ 'Número' | translate }}"
                      required
                      type="text"
                    />
                    <mat-error *ngIf="form.controls['address']?.get('number')?.hasError('required')">
                      {{ 'Número' | translate }} <strong>{{ 'is required' | translate }}</strong>
                    </mat-error>
                  </mat-form-field>
                </div>
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'Entre calles' | translate }}</mat-label>
                  <input
                    formControlName="between"
                    matInput
                    placeholder="{{ 'Entre calles' | translate }}"
                    required
                    type="text"
                  />
                  <mat-error *ngIf="form.controls['address']?.get('between')?.hasError('required')">
                    {{ 'Entre' | translate }} <strong>{{ 'is required' | translate }}</strong>
                  </mat-error>
                </mat-form-field>
              </div>

              <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                <mat-form-field appearance="outline" fxFlex="100" fxFlex.gt-md="48" fxFlex.md="48" id="CI">
                  <mat-label>{{ 'Identity card' | translate }}</mat-label>
                  <input
                    (keypress)="utilsService.keyPressAlphaAndNumbers($event)"
                    [formControl]="this.form.controls['dni']"
                    matInput
                    placeholder="{{ 'Identity card' | translate }}"
                    [required]='businessConfig.isDniRequired'
                    type="text"
                  />
                  <mat-hint>{{ 'Asegúrese de escribirlo correctamente' }}</mat-hint>
                  <mat-error *ngIf="form.controls['dni'].hasError('required')">
                    {{ 'Identity card' | translate }} <strong>{{ 'is required' | translate }}</strong>
                  </mat-error>
                  <mat-error *ngIf="form.controls['dni'].hasError('minlength')">
                    {{ 'Longitud mínima' | translate }} <strong>{{ CI_Length }} {{ 'caracteres' | translate }}</strong>
                  </mat-error>
                </mat-form-field>

                <div fxLayout='row' fxLayoutGap='8px' fxFlex="48" class='w-100' fxFlex.lt-md="100">
                  <guachos-general-autocomplete fxFlex="28" [withoutPaddingBottom]="false" [label]="'Código'"
                                                [valueId]="true"
                                                fxFlex.lt-md="28"
                                                [displayOptions]="callingCodeDisplayOptions" [field]="['code']"
                                                [filterString]="['filter[$and][code][$like]']"
                                                [url]="phoneCodesService.url"
                                                [formControl]="form.get('PhoneCallingCodeId')"></guachos-general-autocomplete>

                  <mat-form-field appearance="outline" fxFlex="70" fxFlex.lt-md="70" id="phone">
                    <mat-label>{{ 'Teléfono' | translate }}</mat-label>
                    <!--                      <span class="mr-2" matPrefix>+ 53</span>-->
                    <input
                      (keypress)="utilsService.keyPressNumbers($event)"
                      [formControl]="form.get('phone')"
                      matInput
                      autocomplete="off"
                      placeholder="{{ 'Teléfono...' | translate }}"
                    />
                    <mat-hint *ngIf="form.get('phone').value && form.get('phone').valid">
                      {{ 'Número válido' | translate }}
                    </mat-hint>
                    <mat-error
                      *ngIf="
                      (form.controls['phone'].hasError('minlength') ||
                        form.controls['phone'].hasError('maxlength')) &&
                      !form.controls['phone'].hasError('pattern')
                    "
                    >
                      {{ 'Longitud del número' | translate }}&nbsp;<strong>{{
                      '8 caracteres, Ex: 51234567' | translate
                      }}</strong>
                    </mat-error>
                  </mat-form-field>
                </div>

<!--                <mat-form-field appearance="outline" fxFlex="100" fxFlex.gt-md="48" fxFlex.md="48" id="phone-checkout">-->
<!--                  <mat-label>{{ 'Phone' | translate }}</mat-label>-->
<!--                  <span class="mr-2" matPrefix>+ 53</span>-->
<!--                  <input-->
<!--                    (keypress)="utilsService.keyPressNumbers($event)"-->
<!--                    [formControl]="this.form.controls['phone']"-->
<!--                    matInput-->
<!--                    placeholder="{{ 'Phone' | translate }}"-->
<!--                    required-->
<!--                  />-->
<!--                  <mat-hint *ngIf="!form.get('phone').value">-->
<!--                    {{ 'Escriba un teléfono móvil cubano, Ex: 51234567' | translate }}-->
<!--                  </mat-hint>-->
<!--                  <mat-hint *ngIf="form.get('phone').value && form.get('phone').valid">-->
<!--                    {{ 'Número válido' | translate }}-->
<!--                  </mat-hint>-->
<!--                  <mat-error *ngIf="form.controls['phone'].hasError('required')">-->
<!--                    {{ 'Phone' | translate }} <strong>{{ 'is required' | translate }}</strong>-->
<!--                  </mat-error>-->
<!--                  <mat-error-->
<!--                    *ngIf="-->
<!--                      (form.controls['phone'].hasError('minlength') || form.controls['phone'].hasError('maxlength')) &&-->
<!--                      !form.controls['phone'].hasError('pattern')-->
<!--                    "-->
<!--                  >-->
<!--                    {{ 'Longitud del número' | translate }}&nbsp;<strong>{{-->
<!--                      '8 caracteres, Ex: 51234567' | translate-->
<!--                    }}</strong>-->
<!--                  </mat-error>-->
<!--                  <mat-error *ngIf="form.controls['phone'].hasError('pattern')">-->
<!--                    {{ 'El número' | translate }}&nbsp;<strong>{{-->
<!--                      'debe empezar con 5, Ex: 51234567' | translate-->
<!--                    }}</strong>-->
<!--                  </mat-error>-->
<!--                </mat-form-field>-->

                <!----------------CUSTOM FIELDS------------------>
                <ng-container *ngIf="customFields?.length > 0 && fields">
                  <p class="mat-body-2 my-2" style="text-transform: uppercase">
                    {{ 'Datos especiales' | translate }}
                    <mat-icon
                      class="iconHelp"
                      matTooltip="{{ 'Datos especiales que solicita el negocio.' | translate }}"
                      style="cursor: pointer"
                      >help
                    </mat-icon>
                  </p>

                  <ng-container *ngFor="let element of fields">
                    <ng-container [ngSwitch]="element.type">
                      <ng-container *ngSwitchCase="'DATE'">
                        <mat-form-field formGroupName="data" appearance="outline">
                          <mat-label>{{ element?.name }}</mat-label>
                          <input
                            matInput
                            [matDatepicker]="picker"
                            [min]="minDate"
                            formControlName="{{ element?.name }}"
                          />
                          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                          <mat-datepicker #picker></mat-datepicker>
                          <mat-error *ngIf="form.controls['data']?.get(element?.name)?.hasError('required')">
                            {{ element?.name }} <strong>{{ 'is required' | translate }}</strong>
                          </mat-error>
                        </mat-form-field>
                      </ng-container>
                      <ng-container *ngSwitchCase="'TIME'">
                        <mat-form-field formGroupName="data" appearance="outline" class="time-icon-style">
                          <mat-label>{{ element?.name }}</mat-label>
                          <input
                            matInput
                            [ngxTimepicker]="toggleTimepicker"
                            [min]="minHour"
                            [max]="maxHour"
                            [format]="24"
                            formControlName="{{ element?.name }}"
                            readonly
                          />
                          <ngx-material-timepicker-toggle
                            matSuffix
                            [for]="toggleTimepicker"
                          ></ngx-material-timepicker-toggle>
                          <ngx-material-timepicker
                            #toggleTimepicker
                            [theme]="timePickerTheme"
                          ></ngx-material-timepicker>
                          <mat-error *ngIf="form.controls['data']?.get(element?.name)?.hasError('required')">
                            {{ element?.name }} <strong>{{ 'is required' | translate }}</strong>
                          </mat-error>
                        </mat-form-field>
                      </ng-container>
                      <ng-container *ngSwitchDefault>
                        <mat-form-field formGroupName="data" appearance="outline">
                          <mat-label>{{ element?.name }}</mat-label>
                          <input
                            matInput
                            formControlName="{{ element?.name }}"
                            placeholder="{{ element?.name }}"
                            [required]="isRequiredField(element?.name)"
                          />
                          <mat-error *ngIf="form.controls['data']?.get(element?.name)?.hasError('required')">
                            {{ element?.name }} <strong>{{ 'is required' | translate }}</strong>
                          </mat-error>
                          <mat-error *ngIf="form.controls['data']?.get(element?.name)?.hasError('pattern')">
                            {{ element?.name }} <strong>{{ 'is invalid' | translate }}</strong>
                          </mat-error>
                        </mat-form-field>
                      </ng-container>
                    </ng-container>
                  </ng-container>
                </ng-container>
                <!------------------------------------------->
              </div>
            </div>

            <div class="add-info">
              <h3 class="grey-800" ngClass.gt-sm="h2" ngClass.xs="h4">{{ 'Aditional information' | translate }}</h3>
            </div>
            <div class="mt-1" fxFlex="100" fxFlex.gt-sm="100" ngClass.sm="mt-1" ngClass.xs="mt-1">
              <mat-form-field appearance="outline" class="w-100">
                <textarea
                  [formControl]="this.form.controls['info']"
                  matInput
                  placeholder="{{ 'Some information about your address or something important' | translate }}"
                  rows="2"
                ></textarea>
              </mat-form-field>
            </div>
            <h1 *ngIf='noGateway' class="tex-align-center p-4 color-red-500">{{ 'Este negocio no tiene método de pago permitido' }}</h1>

            <div class="actions-buttons" fxFlex="grow" fxLayout="row" fxLayoutAlign="space-between start">
              <button mat-stroked-button matStepperPrevious>{{ 'Atrás' | translate }}</button>
              <button
                id="buttonSecondStep"
                (click)="onGoToPayment()"
                [disabled]="noGateway || form.invalid"
                color="primary"
                mat-raised-button
                matStepperNext
              >
                {{ 'Continuar' | translate }}
              </button>
            </div>
          </div>
        </mat-step>
        <mat-step>
          <ng-template matStepLabel>{{ 'Resumen' | translate }}</ng-template>
          <!-- =================================================================== -->
          <!-- PASARELA DE PAGO -->
          <!-- =================================================================== -->
          <div class="mainOrder-wrapper" fxFlex="100" fxFlex.gt-md="50" fxFlex.md="50" fxLayout="column">

            <div *ngIf="!loadingPayment" class="main-order">
              <div class="order-box">
                <ul *ngIf="buyProducts.length <= 0" class="quantity">
                  <li class="empty-checkout">{{ 'There are no products in cart' | translate }}</li>
                </ul>

                <ul *ngIf="!loadingCart && showShipping" class="total-amount">
                  <li>
                    {{ 'Subtotal' | translate }}:
                    <span class="amount px-2">{{
                      getTotalAmountCurrency() | currencyProduct: form.controls['currency'].value
                    }}</span>
                  </li>
                </ul>

                <!-- ============================================ -->
                <!-- TARIFA DE ENVIO -->
                <ul *ngIf="showShipping" class="total">
                  <li>
                    {{ 'Tarifa de envío' | translate }}:

                    <span class="count px-2">
                      {{ getShippingSelectedPrice() | currencyProduct: form.controls['currency'].value }}
                    </span>
                  </li>
                </ul>
                <div
                  *ngIf="!loadingCart"
                  class="mb-3 pb-3"
                  fxLayout="column"
                  fxLayoutAlign="start start"
                  fxLayoutGap="gappx"
                  style="border-bottom: 1px solid #e5e5e5"
                >
                  <div
                    class="w-100"
                    fxLayout="row"
                    fxLayout.xs="column"
                    fxLayoutAlign="space-between center"
                    fxLayoutAlign.xs="start"
                    ngClass.gt-xs="pt-1"
                  >
                    <div fxFlexOrder.xs="2">
                      <!-- ------------------------------------------------- -->
                      <!-- DESCRIPTION OF ADDRESS BUSINESS -->
                      <ng-container>
                        <!-- ============================================ -->
                        <ng-container *ngIf="form.controls['paymentType'].value === 'bidaiondo'">
                          <p class="mat-body-2 my-2" style="text-transform: uppercase">
                            {{ 'Información de Pago' | translate }}
                          </p>
                          <span class="mb-2">{{
                            'Las compras realizadas en el sitio deben exceder el importe de 15.00. Si su compra no alcanza este mínimo, no podremos procesar su orden.'
                              | translate
                          }}</span>
                        </ng-container>

                        <!-- INFO DIRECCION DEL NEGOCIO -->
                        <div
                          *ngIf="!showShipping && buyProducts.length > 0 && hasPickUpPlace"
                          class="mb-3"
                          fxLayout="column"
                        >
                          <p class="mat-body-2 my-2" style="text-transform: uppercase">
                            {{ 'Recogida' | translate }}
                          </p>
                          <span class="mb-2">{{ 'Payment will be made at the Business office' | translate }}</span>
                          <div class="mb-1 font-weight-400" style="color: #585858">
                            {{ 'Negocio' | translate }}:
                            <span class="font-weight-600">{{ theBusiness?.name || '-' }}</span>
                          </div>
                          <div class="mb-1 font-weight-400" style="color: #585858">
                            {{ 'Dirección' | translate }}:
                            <span class="font-weight-600">{{ theBusiness?.address || '-' }}</span>
                          </div>
                          <div class="mb-1 font-weight-400" style="color: #585858">
                            {{ 'Email' | translate }}:
                            <span class="font-weight-600">{{ theBusiness?.email || '-' }}</span>
                          </div>
                        </div>
                      </ng-container>
                    </div>
                  </div>
                </div>

                <!-- ======LOADING====== -->
                <ng-container *ngIf="loadingCart">
                  <div
                    class="py-2 my-2 w-100 loader"
                    fxLayout="row"
                    fxLayoutAlign="start center"
                    fxLayoutGap="gappx"
                    style="border-radius: 4px"
                  ></div>
                  <div
                    class="py-2 my-2 w-100 loader"
                    fxLayout="row"
                    fxLayoutAlign="start center"
                    fxLayoutGap="gappx"
                    style="border-radius: 4px"
                  ></div>
                  <div
                    class="py-2 my-2 w-100 loader"
                    fxLayout="row"
                    fxLayoutAlign="start center"
                    fxLayoutGap="gappx"
                    style="border-radius: 4px"
                  ></div>
                  <div
                    class="py-2 my-2 w-100 loader"
                    fxLayout="row"
                    fxLayoutAlign="start center"
                    fxLayoutGap="gappx"
                    style="border-radius: 4px"
                  ></div>
                  <div
                    class="py-2 my-2 w-100 loader"
                    fxLayout="row"
                    fxLayoutAlign="start center"
                    fxLayoutGap="gappx"
                    style="border-radius: 4px"
                  ></div>
                  <div
                    class="py-2 my-2 w-100 loader"
                    fxLayout="row"
                    fxLayoutAlign="start center"
                    fxLayoutGap="gappx"
                    style="border-radius: 4px"
                  ></div>
                </ng-container>


                <!-- =====TOTAL=====-->
                <ul class="total">
                  <li>
                    {{ 'Total' | translate }}
                    <span class="count px-2">{{
                      getTotalWithShippingIncludedCurrency() | currencyProduct: form.controls['currency'].value
                    }}</span>
                  </li>
                </ul>

                <div class="w-100" fxLayout="row" fxLayoutAlign="center stretch">
                  <a id="pasarelaLink" style="display: none"></a>
                </div>
              </div>
            </div>

            <div
              *ngIf="!loadingPayment"
              class="actions-buttons"
              fxFlex="grow"
              fxLayout="row"
              fxLayoutAlign="space-between start"
            >
              <!--              <button (click)="onGoToInfoDataToPay()" mat-stroked-button>{{ 'Atrás' | translate }}</button>-->
              <button matStepperPrevious mat-stroked-button>{{ 'Atrás' | translate }}</button>
              <button
                (click)="onPayOrder()"
                [disabled]="form.invalid || !buyProducts.length ||
                              (form.controls['paymentType'].value !== 'visa'
                            && form.controls['paymentType'].value !== 'express'
                            && form.controls['paymentType'].value !== 'masterCard'
                            && form.controls['paymentType'].value !== 'dinners-club-internacional'
                            && form.controls['paymentType'].value !== 'jcb'
                            && form.controls['paymentType'].value !== 'maestro'
                            && form.controls['paymentType'].value !== 'electron'
                            && form.controls['paymentType'].value !== 'tarjeta-virtual'
                            && form.controls['paymentType'].value !== 'bizum'
                            && form.controls['paymentType'].value !== 'iupay'
                            && form.controls['paymentType'].value !== 'discover-global'
                            && form.controls['paymentType'].value !== 'peoplegoto'
                            && form.controls['paymentType'].value !== 'paypal'
                            && form.controls['paymentType'].value !== 'multisafepay'
                            && form.controls['paymentType'].value !== 'tropipay'
                            && form.controls['paymentType'].value !== 'enzona'
                            && form.controls['paymentType'].value !== 'transfermovil')"
                color="primary"
                mat-raised-button
              >
                {{ 'Pagar' | translate }}
              </button>
            </div>

            <div *ngIf="loadingPayment" class="loader" style="width: 100%; min-height: 500px; height: 100%"></div>
          </div>
        </mat-step>
      </mat-horizontal-stepper>
    </div>

    <!--    <div fxLayout="row wrap">-->
    <!--      &lt;!&ndash; ============================================================= &ndash;&gt;-->
    <!--      &lt;!&ndash; DATA INFO TO PAY &ndash;&gt;-->
    <!--      &lt;!&ndash; ============================================================= &ndash;&gt;-->
    <!--      <div-->
    <!--        *ngIf="showInfoDataToPay"-->
    <!--        class="billing-details"-->
    <!--        fxFlex="100"-->
    <!--        fxFlex.gt-md="50"-->
    <!--        fxFlex.md="50"-->
    <!--        ngClass.gt-sm="pr-5"-->
    <!--        ngClass.sm="pr-2"-->
    <!--        ngClass.xs="pr-0"-->
    <!--      >-->

    <!--        <div *ngIf="loadingPayment" class="loader" style="width: 100%; min-height: 500px; height: 100%"></div>-->
    <!--      </div>-->
    <!--    </div>-->
  </div>
</div>

<!-- <div *ngIf="this.loadingSearch" class="loading-shade-full">
  <mat-spinner *ngIf="this.loadingSearch" diameter="60" color="primary"></mat-spinner>
</div> -->

<div class="container-checkout" ngClass.lt-md="px-2">
  <div class="checkout sec-padding" ngClass.lt-md="py-2">
    <div *ngIf="loadingPayment" class="w-100 my-3" fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="gappx">
      <div class="loading-dots mat-title">{{ 'Procesando los datos' | translate }}</div>
    </div>
    <div fxLayout="row wrap">
      <div class="billing-details"
           ngClass.gt-sm="pr-5"
           ngClass.sm="pr-2"
           ngClass.xs="pr-0"
           fxFlex="100"
           fxFlex.gt-md="50"
           fxFlex.md="50">
        <div *ngIf="!loadingPayment" class="header-title">
          <h3 class="grey-800" ngClass.gt-sm="h2" ngClass.xs="h4">{{ 'Billing Details' | translate }}</h3>
        </div>

        <form *ngIf="!loadingPayment" [formGroup]="form" fxLayout="row wrap" fxLayoutAlign="start start" class="mt-3">
          <div
            fxLayout="column"
            fxLayoutAlign="start stretch"
            fxFlex="100"
            class="mt-2"
            ngClass.sm="mt-2"
            ngClass.xs="mt-2">
            <p class="mat-body-2 my-2" style="text-transform: uppercase">
              {{ 'Datos personales del destinatario' | translate }}
              <mat-icon
                style="cursor: pointer"
                matTooltip="{{ 'Name and surname of the client as well as a confirmation email' | translate }}"
                class="iconHelp">help
              </mat-icon>
            </p>

            <div fxLayout="row wrap" fxLayoutAlign="space-between center">
              <mat-form-field fxFlex="100" fxFlex.gt-md="48" fxFlex.md="48" appearance="outline">
                <mat-label>{{ 'Name' | translate }}</mat-label>
                <input
                  matInput
                  placeholder="{{ 'Name' | translate }}"
                  required
                  [formControl]="this.form.controls['name']"
                />
                <mat-error *ngIf="form.controls['name'].hasError('required')">
                  {{ 'Name' | translate }} <strong>{{ 'is required' | translate }}</strong>
                </mat-error>
              </mat-form-field>

              <mat-form-field fxFlex="100" fxFlex.gt-md="48" fxFlex.md="48" appearance="outline">
                <mat-label>{{ 'Lastname' | translate }}</mat-label>
                <input
                  matInput
                  placeholder="{{ 'Lastname' | translate }}"
                  required
                  [formControl]="this.form.controls['lastName']"
                />
                <mat-error *ngIf="form.controls['lastName'].hasError('required')">
                  {{ 'Lastname' | translate }} <strong>{{ 'is required' | translate }}</strong>
                </mat-error>
              </mat-form-field>
            </div>

            <mat-form-field appearance="outline">
              <mat-label>{{ 'Email' | translate }}</mat-label>
              <input
                matInput
                placeholder="{{ 'Mail for order confirmation and customer contact ' | translate }}"
                required
                [formControl]="this.form.controls['email']"
              />
              <mat-error *ngIf="form.controls['email'].hasError('required')">
                {{ 'Email' | translate }} <strong>{{ 'is required' | translate }}</strong>
              </mat-error>
            </mat-form-field>

            <!-- <p class="mat-body-2 my-2" style="text-transform: uppercase;">{{'¿Es usted de nacionalidad cubano(a)?'|translate}}
              <mat-icon style="cursor: pointer;" matTooltip="{{'Necesitamos daber hacia donde va dirigido el producto'|translate}}"
                class="iconHelp">help
              </mat-icon>
            </p>

            <mat-form-field appearance="outline">
              <mat-select required type="text" placeholder="{{'Nacionalidad'|translate}}" [formControl]="form.controls['isForCuban']"
                (selectionChange)="onSelectNationality($event.value)">
                <mat-option *ngFor="let na of nationalitiy" [value]="na.id">
                  {{na.name}}
                </mat-option>
              </mat-select>
            </mat-form-field> -->

            <ng-container
              *ngIf="
                form.controls['paymentType'].value === 'visa' ||
                form.controls['paymentType'].value === 'express' ||
                form.controls['paymentType'].value === 'masterCard' ||
                form.controls['paymentType'].value === 'dinners-club-internacional' ||
                form.controls['paymentType'].value === 'jcb' ||
                form.controls['paymentType'].value === 'maestro' ||
                form.controls['paymentType'].value === 'electron' ||
                form.controls['paymentType'].value === 'tarjeta-virtual' ||
                form.controls['paymentType'].value === 'bizum' ||
                form.controls['paymentType'].value === 'iupay' ||
                form.controls['paymentType'].value === 'discover-global'
              ">
              <p class="mat-body-2 my-2" style="text-transform: uppercase">
                {{ 'Select the currency' | translate }}
              </p>
              <div fxLayout="row wrap">
                <mat-form-field fxFlex="48" fxFlex.lt-md="100" appearance="outline">
                  <mat-label>{{ 'Currency' | translate }}</mat-label>
                  <mat-select [formControl]="form.controls['currency']" placeholder="{{ 'Currency' | translate }}">
                    <ng-container *ngFor="let currency of currencies">
                      <mat-option *ngIf="!((currency === 'EUR') && (form.get('paymentType').value === 'transfermovil'))"
                                  [value]="currency">
                      <span class="mat-body-2">
                        {{ currency }}
                      </span>
                      </mat-option>
                    </ng-container>
                  </mat-select>
                </mat-form-field>
              </div>
            </ng-container>

            <p class="mat-body-2 my-2" style="text-transform: uppercase">
              {{ 'Datos del destinatario' | translate }}
              <mat-icon
                style="cursor: pointer"
                matTooltip="{{ 'Street address and more information about the shipping address' | translate }}"
                class="iconHelp"
              >help
              </mat-icon>
            </p>

            <!-- SOLO PARA CUBANOS -->
            <ng-container *ngIf="onlyCubanPeople">
              <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                <mat-form-field fxFlex="48" fxFlex.lt-md="100" appearance="outline">
                  <mat-label>{{ 'Provincia' | translate }}</mat-label>
                  <mat-select
                    [compareWith]="compareById"
                    required
                    type="text"
                    placeholder="{{ 'Nombre de la provincia' | translate }}"
                    [formControl]="form.controls['ProvinceId']"
                    (selectionChange)="onSelectProvince($event.value)"
                  >
                    <mat-option *ngFor="let province of allProvinces" [value]="province.id">
                      {{ province.name }}
                    </mat-option>
                  </mat-select>
                  <mat-error *ngIf="form.controls['ProvinceId'].hasError('required')">
                    {{ 'Provincia' | translate }} <strong>{{ 'is required' | translate }}</strong>
                  </mat-error>
                </mat-form-field>

                <mat-form-field fxFlex="48" fxFlex.lt-md="100" appearance="outline">
                  <mat-label>{{ 'Municipio' | translate }}</mat-label>
                  <mat-select
                    [compareWith]="compareById"
                    required
                    type="text"
                    placeholder="{{ 'Nombre del Municipio' | translate }}"
                    [formControl]="form.controls['MunicipalityId']"
                    (selectionChange)="form.controls['ShippingBusinessId'].setValue(null)"
                  >
                    <mat-option *ngFor="let municipio of municipalities" [value]="municipio.id">
                      {{ municipio.name }}
                    </mat-option>
                  </mat-select>
                  <mat-error *ngIf="form.controls['MunicipalityId'].hasError('required')">
                    {{ 'Municipio' | translate }} <strong>{{ 'is required' | translate }}</strong>
                  </mat-error>
                </mat-form-field>
              </div>
            </ng-container>

            <!-- SOLO PARA EXTRANGEROS -->
            <ng-container *ngIf="!onlyCubanPeople">
              <p class="mat-body-2 my-2" style="text-transform: uppercase">
                {{ "Customer's location data" | translate }}
                <mat-icon
                  style="cursor: pointer"
                  matTooltip="{{
                    'Country, city, region and more information about the shipping location' | translate
                  }}"
                  class="iconHelp"
                >help
                </mat-icon>
              </p>

              <mat-form-field appearance="outline">
                <mat-label>{{ 'Country' | translate }}</mat-label>
                <mat-select
                  [compareWith]="compareById"
                  required
                  type="text"
                  placeholder="{{ 'Country name' | translate }}"
                  [formControl]="form.controls['CountryId']"
                >
                  <mat-option *ngFor="let country of allCountries" [value]="country.id">
                    {{ utilsService.parserLanguage(country.name, language) }}
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="form.controls['CountryId'].hasError('required')">
                  {{ 'Country' | translate }} <strong>{{ 'is required' | translate }}</strong>
                </mat-error>
              </mat-form-field>

              <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                <mat-form-field fxFlex="48" fxFlex.lt-md="100" appearance="outline">
                  <mat-label>{{ 'City' | translate }}</mat-label>
                  <input
                    type="text"
                    matInput
                    placeholder="{{ 'City' | translate }}"
                    required
                    [formControl]="this.form.controls['city']"
                  />
                  <mat-error *ngIf="form.controls['city'].hasError('required')">
                    {{ 'City' | translate }} <strong>{{ 'is required' | translate }}</strong>
                  </mat-error>
                </mat-form-field>

                <mat-form-field fxFlex="48" fxFlex.lt-md="100" appearance="outline">
                  <mat-label>{{ 'State / Province / Region' | translate }}</mat-label>
                  <input
                    type="text"
                    matInput
                    placeholder="{{ 'State / Province / Region' | translate }}"
                    required
                    [formControl]="this.form.controls['regionProvinceState']"
                  />
                  <mat-error *ngIf="form.controls['regionProvinceState'].hasError('required')">
                    {{ 'State / Province / Region' | translate }} <strong>{{ 'is required' | translate }}</strong>
                  </mat-error>
                </mat-form-field>
              </div>
            </ng-container>

            <mat-form-field appearance="outline" class="w-100">
              <mat-label>{{ 'Street address' | translate }}</mat-label>
              <textarea
                required
                placeholder="{{ 'Street address or your location' | translate }}"
                matInput
                rows="2"
                [formControl]="this.form.controls['address']"
              ></textarea>
              <mat-error *ngIf="form.controls['address'].hasError('required')">
                {{ 'Address' | translate }} <strong>{{ 'is required' | translate }}</strong>
              </mat-error>
            </mat-form-field>

            <!-- <mat-form-field fxFlex="100" fxFlex.gt-md="48" fxFlex.md="48" appearance="outline">
              <mat-label>{{'More info about your address'|translate}}</mat-label>
              <input matInput placeholder="{{'Apartment, suite, unit, building, floor'|translate}}"
                [formControl]="this.form.controls['address2']">
            </mat-form-field> -->

            <div fxLayout="row wrap" fxLayoutAlign="space-between center">
              <mat-form-field fxFlex="100" fxFlex.gt-md="48" fxFlex.md="48" appearance="outline">
                <mat-label>{{ 'Identity card' | translate }}</mat-label>
                <input
                  matInput
                  placeholder="{{ 'Identity card' | translate }}"
                  type="text"
                  required
                  [formControl]="this.form.controls['dni']"
                />
                <mat-error *ngIf="form.controls['dni'].hasError('required')">
                  {{ 'Identity card' | translate }} <strong>{{ 'is required' | translate }}</strong>
                </mat-error>
              </mat-form-field>

              <mat-form-field fxFlex="100" fxFlex.gt-md="48" fxFlex.md="48" appearance="outline">
                <mat-label>{{ 'Phone' | translate }} *</mat-label>
                <input
                  matInput
                  placeholder="{{ 'Phone' | translate }}"
                  type="tel"
                  [formControl]="this.form.controls['phone']"
                />
                <mat-error *ngIf="form.controls['phone'].hasError('required')">
                  {{ 'Phone' | translate }} <strong>{{ 'is required' | translate }}</strong>
                </mat-error>
                <mat-error *ngIf="form.controls['phone'].hasError('minlength')">
                  {{ 'El teléfono debe tener 10 dígitos' | translate }}
                </mat-error>
                <mat-error *ngIf="form.controls['phone'].hasError('maxlength')">
                  {{ 'El teléfono debe tener 10 dígitos' | translate }}
                </mat-error>
                <mat-error *ngIf="form.controls['phone'].hasError('pattern')">
                  {{ 'El teléfono debe tener solo dígitos' | translate }}
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <div class="add-info">
            <h3 class="grey-800" ngClass.gt-sm="h2" ngClass.xs="h4">{{ 'Aditional information' | translate }}</h3>
          </div>
          <div fxFlex="100" fxFlex.gt-sm="100" class="mt-1" ngClass.sm="mt-1" ngClass.xs="mt-1">
            <mat-form-field appearance="outline" class="w-100">
              <textarea
                placeholder="{{ 'Some information about your address or something important' | translate }}"
                matInput
                rows="2"
                [formControl]="this.form.controls['info']"
              ></textarea>
            </mat-form-field>
          </div>
        </form>

        <div *ngIf="loadingPayment" style="width: 100%; min-height: 500px; height: 100%" class="loader"></div>
      </div>

      <div class="mainOrder-wrapper pl-15" fxFlex="100" fxFlex.gt-md="50" fxFlex.md="50">
        <div *ngIf="!loadingPayment" class="header-title" ngClass.xs="mt-3" ngClass.sm="mt-3">
          <h3 class="grey-800" ngClass.gt-sm="h2" ngClass.xs="h4">{{ 'My Order' | translate }}</h3>
        </div>
        <div *ngIf="!loadingPayment" class="main-order" style="margin-top: 26px">
          <div class="order-box">
            <div class="title-box">
              <div>
                {{ 'Product' | translate }} <span class="tl-amount"> {{ 'Total' | translate }}</span>
              </div>
            </div>
            <div *ngIf="buyProducts.length" class="responsive_table">
              <table mat-table [dataSource]="dataSource">
                <ng-container matColumnDef="product">
                  <th class="text-center" style="width: 10%" mat-header-cell *matHeaderCellDef>
                    <span class="mat-subheading-1">{{ 'Name' | translate }}</span>
                  </th>
                  <td class="py-2" mat-cell *matCellDef="let element">
                    <div fxLayout="row" fxLayoutAlign="start center">
                      <img
                        *ngIf="element.Product.Images && element.Product.Images.length"
                        [src]="imageUrl + element.Product.Images[0].image"
                      />
                      <img
                        *ngIf="!(element.Product.Images && element.Product.Images.length)"
                        src="../../../../assets/images/noImage.jpg"
                      />
                      <p class="name">
                        <a [href]="'/product?productId=' + element.ProductId + '&stockId=' + element.StockId"
                        ><strong class="color-grey-800">{{
                          element.Product.name[language] ? element.Product.name[language] : element.Product.name['es']
                          }}</strong></a
                        >
                      </p>
                    </div>
                  </td>
                </ng-container>

                <ng-container matColumnDef="quantity">
                  <th style="width: 10%" class="text-center" mat-header-cell *matHeaderCellDef>
                    <span class="mat-subheading-1">{{ 'Quantity' | translate }}</span>
                  </th>
                  <td mat-cell *matCellDef="let element">
                    <div fxLayout="row" fxLayoutAlign="center center">
                      <strong style="font-size: 17px">x {{ element.quantity }}</strong>
                    </div>
                  </td>
                </ng-container>

                <ng-container matColumnDef="price">
                  <th class="text-center" style="width: 10%" mat-header-cell *matHeaderCellDef>
                    <span class="mat-subheading-1">{{ 'Price' | translate }}</span>
                  </th>
                  <td mat-cell *matCellDef="let element">
                    <div fxLayout="row" fxLayoutAlign="center center">
                      <strong style="font-size: 16px">
                        {{ getTotalPricePerItemCurrency(element) | currencyMarket: form.controls['currency'].value }}
                      </strong>
                    </div>
                  </td>
                </ng-container>
                <ng-container matColumnDef="action">
                  <th class="text-center" style="width: 10%" mat-header-cell *matHeaderCellDef></th>
                  <td mat-cell *matCellDef="let element">
                    <button
                      (click)="removeItem(element)"
                      class="ml-auto"
                      mat-icon-button
                      color="warn"
                      matTooltip="{{ 'Eliminar producto del carrito' | translate }}"
                    >
                      <mat-icon>clear</mat-icon>
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                <tr mat-row class="rowData" *matRowDef="let row; columns: displayedColumns"></tr>
              </table>
            </div>
            <!--<ul class="price-list" *ngIf="buyProducts.length">
              <li *ngFor="let item of buyProducts">
                <div fxLayout="row" fxLayoutAlign="start center" class="py-2" fxLayoutGap="gappx">
                  <div fxFlex="63" class="product" fxLayout="row" fxLayoutAlign="start center">
                    <img
                      fxHide.xs
                      *ngIf="item.Product.Images && item.Product.Images.length"
                      [src]="imageUrl + item.Product.Images[0].image"
                    />
                    <img
                      fxHide.xs
                      *ngIf="!(item.Product.Images && item.Product.Images.length)"
                      src="../../../../assets/images/noImage.jpg"
                    />

                    <p class="name">
                      <a [href]="'/product?productId=' + item.ProductId + '&stockId=' + item.StockId"
                        ><strong class="color-grey-800">{{
                          item.Product.name[language] ? item.Product.name[language] : item.Product.name['es']
                        }}</strong></a
                      >
                      &nbsp; <strong style="font-size: 17px">x {{ item.quantity }}</strong>
                    </p>
                  </div>

                  <div fxFlex fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="gappx">
                    <span>
                      {{ getTotalPricePerItem(item) | currencyMarket: marketCard }}
                    </span>
                    <button
                      (click)="removeItem(item)"
                      class="ml-auto"
                      mat-icon-button
                      color="warn"
                      matTooltip="{{ 'Eliminar producto del carrito' | translate }}"
                    >
                      <mat-icon>clear </mat-icon>
                    </button>
                  </div>
                </div>
              </li>
            </ul>-->
            <ul class="quantity" *ngIf="buyProducts.length <= 0">
              <li class="empty-checkout">{{ 'There are no products in cart' | translate }}</li>
            </ul>
            <ul *ngIf="!loadingCart && showShipping" class="total-amount">
              <li>
                {{ 'Subtotal' | translate }}:
                <span class="amount px-2">{{
                  getTotalAmountCurrency() | currencyMarket: form.controls['currency'].value
                  }}</span>
              </li>
            </ul>

            <!-- ////////////////TARIFAS DE ENVIO/////////////////////////////////////////// -->

            <div
              class="mb-3 pb-3"
              *ngIf="!loadingCart"
              fxLayout="column"
              fxLayoutAlign="start start"
              fxLayoutGap="gappx"
              style="border-bottom: 1px solid #e5e5e5"
            >
              <div
                fxLayout="row"
                class="w-100"
                fxLayout.xs="column"
                ngClass.gt-xs="pt-1"
                fxLayoutAlign="space-between center"
                fxLayoutAlign.xs="start"
              >
                <div fxFlexOrder.xs="2">
                  <p
                    *ngIf="showShipping"
                    matTooltip="{{ 'Sistemas de precio del envio de sus productos a la localización brindada' }}"
                    style="font-size: 16px; font-weight: 500; margin-bottom: 12px !important"
                  >
                    {{ 'Seleccione una tarifa de envío*' | translate }}:
                  </p>
                  <p *ngIf="!showShipping" class="mb-3 mt-4"
                     style="color: #f44336; font-size: 16px; font-weight: 500; margin-bottom: 12px !important">
                    {{ 'Payment will be made at the Business office' | translate }}
                  </p>
                </div>

                <div fxLayout fxLayoutAlign="start center">
                  <mat-icon
                    *ngIf="form.controls['ShippingBusinessId'] && form.controls['ShippingBusinessId'].value"
                    (click)="detailsShipping()"
                    matTooltip="{{ 'Shipping Rates Details' | translate }}"
                    class="mr-3"
                    style="margin-bottom: 12px; font-size: 25px; cursor: pointer"
                  >visibility
                  </mat-icon
                  >
                  <!--                  <mat-checkbox-->
                  <!--                    ngClass.xs="mb-2"-->
                  <!--                    fxFlexOrder.xs="1"-->
                  <!--                    style="margin-bottom: 12px"-->
                  <!--                    [formControl]="form.get('shippingRequired')"-->
                  <!--                  >-->
                  <!--                    <span class="mat-body-2">{{ 'Shipping required' | translate }}</span>-->
                  <!--                  </mat-checkbox>-->
                </div>
              </div>

              <div
                class="w-100"
                style="position: relative"
                *ngIf="showShipping"
                fxLayout="column"
                fxLayoutAlign="start start"
                fxLayoutGap="gappx"
              >
                <div *ngIf="inLoading" class="loading-shade" style="height: 100%">
                  <mat-spinner [diameter]="40" *ngIf="inLoading"></mat-spinner>
                </div>
                <mat-radio-group [formControl]="form.get('ShippingBusinessId')" class="w-100">
                  <mat-radio-button
                    matTooltip="{{ shipping?.Business?.name }}"
                    style="height: 50px"
                    class="w-100"
                    *ngFor="let shipping of shippingData"
                    f
                    [value]="shipping.BusinessId"
                  >
                    <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="gappx">
                      <div fxLayoutAlign="start center">
                        <img
                          style="height: 32px; width: 32px; border-radius: 50%; object-fit: cover; margin-left: 8px"
                          [src]="imageUrl + shipping?.Business?.logo"
                          onerror="this.onerror=null;this.src='assets/images/noImage.jpg';"
                        />
                        <span fxHide.xs class="ml-2 mat-caption" style="color: black">
                          {{ 'Entrega a través de ' | translate }}
                        </span>
                        <span class="ml-2 mat-caption" style="color: black"> ({{ shipping?.Business?.name }}) </span>
                      </div>

                      <span fxFlex="35" class="taxAmount" style="font-size: 20px"
                      >{{ shipping.totalPrice || 0 | currencyMarket: marketCard }}
                      </span>
                    </div>
                  </mat-radio-button>
                </mat-radio-group>

                <ng-container
                  *ngIf="!this.form.get('ProvinceId').valid && !this.form.get('MunicipalityId').valid; else showMessage"
                >
                  <span class="my-2" style="font-size: 16px; font-weight: 500; color: #f44336">
                    {{ '*These products cannot be shipped specify a location' | translate }}
                  </span>
                </ng-container>
                <ng-template #showMessage>
                  <ng-container
                    *ngIf="
                      !canBeDelivery || !this.form.get('ProvinceId').valid || !this.form.get('MunicipalityId').valid
                    "
                  >
                    <span class="my-2" style="font-size: 16px; font-weight: 500; color: #f44336">
                      {{ '*Estos productos no pueden ser enviados a la localización proporcionada' | translate }}
                    </span>
                  </ng-container>
                </ng-template>
              </div>
            </div>

            <ng-container *ngIf="loadingCart">
              <div
                class="py-2 my-2 w-100 loader"
                style="border-radius: 4px"
                fxLayout="row"
                fxLayoutAlign="start center"
                fxLayoutGap="gappx"
              ></div>
              <div
                class="py-2 my-2 w-100 loader"
                style="border-radius: 4px"
                fxLayout="row"
                fxLayoutAlign="start center"
                fxLayoutGap="gappx"
              ></div>
              <div
                class="py-2 my-2 w-100 loader"
                style="border-radius: 4px"
                fxLayout="row"
                fxLayoutAlign="start center"
                fxLayoutGap="gappx"
              ></div>
              <div
                class="py-2 my-2 w-100 loader"
                style="border-radius: 4px"
                fxLayout="row"
                fxLayoutAlign="start center"
                fxLayoutGap="gappx"
              ></div>
              <div
                class="py-2 my-2 w-100 loader"
                style="border-radius: 4px"
                fxLayout="row"
                fxLayoutAlign="start center"
                fxLayoutGap="gappx"
              ></div>
              <div
                class="py-2 my-2 w-100 loader"
                style="border-radius: 4px"
                fxLayout="row"
                fxLayoutAlign="start center"
                fxLayoutGap="gappx"
              ></div>
            </ng-container>
            <ul class="total">
              <li>
                {{ 'Total' | translate }}
                <span class="count px-2">{{
                  getTotalWithShippingIncludedCurrency() | currencyMarket: form.controls['currency'].value
                  }}</span>
              </li>
            </ul>
            <p class="my-2">
              <strong>{{ 'Pasarelas para efectuar el pago' | translate }}</strong>
            </p>
            <div class="paymentFinal" id="payment-method">
              <mat-radio-group [formControl]="form.get('paymentType')" fxLayout.lt-sm="column" fxLayout="row wrap"
                               fxLayoutGap="10px grid">
                <ng-container *ngFor="let pay of payments">
                  <ng-container *ngIf="this.onlyCubanPeople
                                      && cart?.market === 'national'
                                      && pay?.market === 'national'">
                    <mat-radio-button fxFlex="50%" fxFlex.lt-sm="100%"
                                      [value]="pay.id"
                                      class="w-100">
                      {{this.onlyCubanPeople}} - {{cart?.market}}
                      <div fxLayout="row" fxLayoutAlign="start center" class="w-100 pay-method-container"
                           [ngClass]="{'payment-active': form.get('paymentType').value === pay.id}">
                        <img [src]="pay.logo" class="pay-method-icon pr-2" />
                        <span class="mat-body-2 uppercase pay-method-name">
                          {{ pay.name }}
                        </span>
                      </div>
                    </mat-radio-button>
                  </ng-container>

                  <ng-container *ngIf="this.onlyCubanPeople
                                      && cart?.market === 'international'
                                      && pay?.market === 'international'">
                    <mat-radio-button fxFlex="50%" fxFlex.lt-sm="100%"
                                      *ngIf="this.onlyCubanPeople && cart?.market === 'international'"
                                      [value]="pay.id"
                                      class="w-100">
                      <div fxLayoutAlign="start center" class="w-100 pay-method-container"
                           [ngClass]="{'payment-active': form.get('paymentType').value === pay.id}">
                        <img [src]="pay.logo" class="pay-method-icon pr-2" />
                        <span class="mat-body-2 uppercase pay-method-name">
                          {{ pay.name }}
                        </span>
                      </div>
                    </mat-radio-button>
                  </ng-container>
                </ng-container>
              </mat-radio-group>
            </div>
            <!-- <p class="my-2">
              <strong>{{'*Taxes and shipping included'|translate}}</strong>
            </p> -->
            <div fxLayout="row" class="w-100" fxLayoutAlign="center stretch">
              <button
                [ngClass]="{
                  paypalBtn: form.valid && buyProducts.length,
                  paypalBtnInvalid: form.invalid || !buyProducts.length
                }"
                mat-raised-button
                [disabled]="form.invalid || !buyProducts.length"
                (click)="onPayOrder()"
              >
                <span style="text-align: center">
                  {{ 'PAGAR' | translate }}
                </span>
              </button>
              <a style="display: none" id="pasarelaLink"></a>
            </div>
          </div>
        </div>
        <div *ngIf="loadingPayment" style="width: 100%; min-height: 500px; height: 100%" class="loader"></div>
      </div>
    </div>
  </div>
</div>

<!--<div *ngIf="showTransfermovilImage" class="popup">
  <div fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="gappx">
    <button mat-icon-button (click)="onCancelarTranfermovilPayment()">
      <mat-icon matTooltip="{{ 'Cancelar la confirmación de pago con transfermóvil' | translate }}" class="mat-18"
        >clear</mat-icon
      >
    </button>
  </div>
  <div fxLayout="column" fxLayoutAlign="start center" fxLayoutAlign.lt-md="start start" fxLayoutGap="gappx">
    <p ngClass.gt-sm="mat-title" ngClass.lt-md="mat-title" style="color: #fff">
      {{ 'Confirmación de pago usando transfermóvil.' | translate }}
    </p>
    <ul style="color: #fff">
      <div fxHide.lt-md>
        <li>
          {{ 'Abra la aplicación de transfermóvil en su teléfono.' | translate }}
        </li>
        <li>
          {{ 'Seleccione su banco y autentíquese.' | translate }}
        </li>
        <li>
          {{ 'Entre en la opción de "Operaciones" y pulse la opción de pago en línea.' | translate }}
        </li>
        <li>
          {{ 'Precione el botón de lectura de qr y realize su pago.' | translate }}
        </li>
      </div>
      <a [href]="domSanitizer.bypassSecurityTrustUrl(this.launchTM)" class="mt-2" mat-flat-button>
        {{ 'Abrir la app de tranfermovil' | translate }}</a
      >
    </ul>
  </div>

  <div fxFlexFill fxLayout="column" fxLayoutAlign="start center">
    <img class="mt-4" [src]="this.qrTransfermovilImage" />
    <div style="max-width: 20rem" fxLayout="row" fxLayoutAlign="start end" fxLayoutGap="gappx">
      <span class="mat-title mt-3">
        {{ 'Total' | translate }}: &nbsp;{{ finalPrice | currencyMarket: marketCard }}
      </span>
    </div>
  </div>
</div>-->
